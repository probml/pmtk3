function yhat = svmlightPredict(model, X)
% This is a simple interface to svm_light,which must be on the system path.
%
% model  - a struct generated by svmlightFit()
% yhat   - output is in {-1, 1}, (unless regression)

% You can use the addtosystempath function to add the directory containing
% svm_classify.exe.

X =  mkUnitVariance(center(X));
testOptions = '';
tmp = tempdir();
testFile    = fullfile(tmp, 'test.svm');
modelFile   = model.file;
resultsFile = fullfile(tmp, 'results.svm');
svmlightWriteData(X, zeros(size(X, 1), 1), testFile, '%d');
command = sprintf('svm_classify %s %s %s %s',...
    testOptions, testFile, modelFile, resultsFile);
[iserror, response] = system(command);
if iserror
    error('There was a problem calling svmlight (svm_classify): %s', response);
end
yhat = dlmread(resultsFile);
if strcmp(model.problemType, 'classification')
    yhat = sign(yhat);
end
end