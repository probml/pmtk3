
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      --><title>SVM Regression Demo</title><meta name="generator" content="MATLAB 7.10"><meta name="date" content="2010-04-07"><meta name="m-file" content="svmRegrDemo"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head><body><div class="content"><h1>SVM Regression Demo</h1><pre class="codeinput">nVars = 1;
nInstances = 50;
setSeed(0);

<span class="comment">%[X,y] = makeData('regressionNonlinear',nInstances,nVars);</span>
<span class="comment">% sinc function</span>
N = 100;
noise		= 0.1;
x	= 10*[-1:2/(N-1):1]';
ytrue	= sin(abs(x))./abs(x);
y	= ytrue + noise*randn(N,1);
X = mkUnitVariance(centerCols(x));

<span class="comment">% We pick  hyperparameters that result in a pretty plot</span>
lambda = 0.5;
rbfScale = 0.3;
kernelFn = @(X1,X2) kernelRbfSigma(X1,X2,rbfScale);
Ktrain =  kernelFn(X, X);
<span class="comment">%Xtest = [-5:.05:5]';</span>
Xtest = (-10:.1:10)';
Xtest = mkUnitVariance(centerCols(Xtest));
Ktest = kernelFn(Xtest, X);

<span class="keyword">for</span> method=1:4
    <span class="keyword">switch</span> method
        <span class="keyword">case</span> 1,
            model = linregFit(X, y, <span class="string">'regType'</span>, <span class="string">'L2'</span>, <span class="string">'lambda'</span>, lambda,<span class="keyword">...</span>
                <span class="string">'kernelFn'</span>, @kernelRbfSigma,<span class="string">'kernelParam'</span>, rbfScale);
            w = model.w;
            yhat = linregPredict(model, Xtest);
            lossStr = sprintf(<span class="string">'linregL2'</span>);
            fname = <span class="string">'linregL2'</span>;
        <span class="keyword">case</span> 2,
            model = linregFit(X, y, <span class="string">'regType'</span>, <span class="string">'L1'</span>, <span class="string">'lambda'</span>, lambda,<span class="keyword">...</span>
                <span class="string">'kernelFn'</span>, @kernelRbfSigma,<span class="string">'kernelParam'</span>, rbfScale);
            w = model.w;
            SV = find(abs(w) &gt; 1e-5);
            yhat = linregPredict(model, Xtest);
            lossStr = sprintf(<span class="string">'linregL1'</span>);
            fname = <span class="string">'linregL1'</span>;
        <span class="keyword">case</span> 3,
            epsilon = 0.1; <span class="comment">% default</span>
            gamma = 1/(2*rbfScale^2);
            C = 1/lambda;
            model = svmFit(X, y,<span class="keyword">...</span>
                <span class="string">'kernel'</span>, @kernelRbfGamma, <span class="string">'kernelParam'</span>, gamma, <span class="keyword">...</span>
                <span class="string">'fitFn'</span>, @svmQPregFit, <span class="string">'C'</span>, C);
            SV = model.svi;
            <span class="comment">%[model, SV] = svmQPregFit(X, y, kernelFn, epsilon, 1*(1/lambda));</span>
            w = model.alpha;
            lossStr = sprintf(<span class="string">'SVM(%s=%6.4f)'</span>, <span class="string">'\epsilon'</span>, epsilon);
            fname = <span class="string">'SVMQP'</span>;
            yhat = svmPredict(model, Xtest);
        <span class="keyword">case</span> 4
            C = 1/lambda;
            gamma = 1/(2*rbfScale^2);
            model = svmFit(X, y, <span class="string">'C'</span>, C, <span class="string">'kernel'</span>, <span class="string">'rbf'</span>, <span class="keyword">...</span>
                <span class="string">'kernelParam'</span>, gamma,<span class="string">'fitFn'</span>, @svmlightFit);
            w = model.alpha;
            SV = model.svi;
            lossStr = <span class="string">'SVMlight'</span>;
            fname = <span class="string">'SVMlight'</span>;
            yhat = svmPredict(model, Xtest);
    <span class="keyword">end</span>


    <span class="comment">% Plot results</span>
    figure; hold <span class="string">on</span>;
    plot(X,y,<span class="string">'*'</span>, <span class="string">'markersize'</span>, 8, <span class="string">'linewidth'</span>, 2);
    h=plot(Xtest(:,1),yhat,<span class="string">'g-'</span>);
    set(h,<span class="string">'LineWidth'</span>,3);
    <span class="keyword">if</span> method&gt;1 <span class="comment">% strcmp(lossStr(1:3), 'SVM')</span>
        <span class="comment">%SV = abs(Krbf*uRBF - y) &gt;= changePoint;</span>
        plot(X(SV),y(SV),<span class="string">'o'</span>,<span class="string">'color'</span>,<span class="string">'r'</span>, <span class="string">'markersize'</span>, 12, <span class="string">'linewidth'</span>, 2);
        <span class="comment">%plot(Xtest(:,1),yhat+epsilon,'c--', 'linewidth', 2);</span>
        <span class="comment">%plot(Xtest(:,1),yhat-epsilon,'c--', 'linewidth', 2);</span>
        legend({<span class="string">'Data'</span>,<span class="string">'prediction'</span>,<span class="string">'Support Vectors'</span>});
        <span class="comment">%legend({'Data','prediction','Support Vectors','Eps-Tube'});</span>
    <span class="keyword">end</span>
    title(sprintf(<span class="string">'%s'</span>, lossStr))
    printPmtkFigure(sprintf(<span class="string">'svmRegrDemoData%s'</span>, fname))

    figure; stem(w)
    title(sprintf(<span class="string">'weights for %s'</span>, lossStr))
    axis_pct
    printPmtkFigure(sprintf(<span class="string">'svmRegrDemoStem%s'</span>, fname))
<span class="keyword">end</span>
placeFigures;
</pre><pre class="codeoutput">ans =
  Columns 1 through 3
   -5.0000  105.0000   -0.1040
  Column 4
    0.0730
ans =
  Columns 1 through 3
   -5.0000  105.0000   -0.3301
  Column 4
    0.6764
ans =
  Columns 1 through 3
   -5.0000  105.0000   -2.2000
  Column 4
    2.2000
ans =
  Columns 1 through 3
   -5.0000  105.0000   -2.2000
  Column 4
    2.2000
</pre><img vspace="5" hspace="5" src="svmRegrDemo_01.png" alt=""> <img vspace="5" hspace="5" src="svmRegrDemo_02.png" alt=""> <img vspace="5" hspace="5" src="svmRegrDemo_03.png" alt=""> <img vspace="5" hspace="5" src="svmRegrDemo_04.png" alt=""> <img vspace="5" hspace="5" src="svmRegrDemo_05.png" alt=""> <img vspace="5" hspace="5" src="svmRegrDemo_06.png" alt=""> <img vspace="5" hspace="5" src="svmRegrDemo_07.png" alt=""> <img vspace="5" hspace="5" src="svmRegrDemo_08.png" alt=""> <p class="footer"><br>
      Published with MATLAB&reg; 7.10<br></p></div><!--
##### SOURCE BEGIN #####
%% SVM Regression Demo
nVars = 1;
nInstances = 50;
setSeed(0);

%[X,y] = makeData('regressionNonlinear',nInstances,nVars);
% sinc function
N = 100;
noise		= 0.1;
x	= 10*[-1:2/(N-1):1]';
ytrue	= sin(abs(x))./abs(x);
y	= ytrue + noise*randn(N,1);
X = mkUnitVariance(centerCols(x)); 

% We pick  hyperparameters that result in a pretty plot
lambda = 0.5;
rbfScale = 0.3;
kernelFn = @(X1,X2) kernelRbfSigma(X1,X2,rbfScale);
Ktrain =  kernelFn(X, X);
%Xtest = [-5:.05:5]';
Xtest = (-10:.1:10)';
Xtest = mkUnitVariance(centerCols(Xtest)); 
Ktest = kernelFn(Xtest, X);

for method=1:4
    switch method
        case 1,
            model = linregFit(X, y, 'regType', 'L2', 'lambda', lambda,...
                'kernelFn', @kernelRbfSigma,'kernelParam', rbfScale);
            w = model.w;
            yhat = linregPredict(model, Xtest);
            lossStr = sprintf('linregL2');
            fname = 'linregL2';
        case 2,
            model = linregFit(X, y, 'regType', 'L1', 'lambda', lambda,...
                'kernelFn', @kernelRbfSigma,'kernelParam', rbfScale);
            w = model.w;
            SV = find(abs(w) > 1e-5);
            yhat = linregPredict(model, Xtest);
            lossStr = sprintf('linregL1');
            fname = 'linregL1';
        case 3,
            epsilon = 0.1; % default
            gamma = 1/(2*rbfScale^2);
            C = 1/lambda;
            model = svmFit(X, y,...
                'kernel', @kernelRbfGamma, 'kernelParam', gamma, ...
                'fitFn', @svmQPregFit, 'C', C); 
            SV = model.svi;
            %[model, SV] = svmQPregFit(X, y, kernelFn, epsilon, 1*(1/lambda));
            w = model.alpha;
            lossStr = sprintf('SVM(%s=%6.4f)', '\epsilon', epsilon);
            fname = 'SVMQP';
            yhat = svmPredict(model, Xtest);
        case 4
            C = 1/lambda;
            gamma = 1/(2*rbfScale^2);
            model = svmFit(X, y, 'C', C, 'kernel', 'rbf', ...
                'kernelParam', gamma,'fitFn', @svmlightFit);
            w = model.alpha;
            SV = model.svi;
            lossStr = 'SVMlight';
            fname = 'SVMlight';
            yhat = svmPredict(model, Xtest);
    end
    
    
    % Plot results
    figure; hold on;
    plot(X,y,'*', 'markersize', 8, 'linewidth', 2);
    h=plot(Xtest(:,1),yhat,'g-');
    set(h,'LineWidth',3);
    if method>1 % strcmp(lossStr(1:3), 'SVM')
        %SV = abs(Krbf*uRBF - y) >= changePoint;
        plot(X(SV),y(SV),'o','color','r', 'markersize', 12, 'linewidth', 2);
        %plot(Xtest(:,1),yhat+epsilon,'cREPLACE_WITH_DASH_DASH', 'linewidth', 2);
        %plot(Xtest(:,1),yhat-epsilon,'cREPLACE_WITH_DASH_DASH', 'linewidth', 2);
        legend({'Data','prediction','Support Vectors'});
        %legend({'Data','prediction','Support Vectors','Eps-Tube'});
    end
    title(sprintf('%s', lossStr))
    printPmtkFigure(sprintf('svmRegrDemoData%s', fname))
    
    figure; stem(w)
    title(sprintf('weights for %s', lossStr))
    axis_pct
    printPmtkFigure(sprintf('svmRegrDemoStem%s', fname))
end
placeFigures;


##### SOURCE END #####
--></body></html>