
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      --><title>mixGaussMLvsMAP</title><meta name="generator" content="MATLAB 7.10"><meta name="date" content="2010-03-23"><meta name="m-file" content="mixGaussMLvsMAP"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">Demonstrate failure of MLE for GMMs in high-D case, whereas MAP works</a></li><li><a href="#2">Create data</a></li><li><a href="#4">Fit</a></li><li><a href="#6">Plot</a></li></ul></div><h2>Demonstrate failure of MLE for GMMs in high-D case, whereas MAP works<a name="1"></a></h2><pre class="codeinput"><span class="comment">%PMKTauthor Hannes Bretschneider</span>
<span class="comment">%PMTKslow</span>
</pre><h2>Create data<a name="2"></a></h2><pre class="codeinput">N = 100;
K = 3;
dims = 10:10:100;
warning(<span class="string">'off'</span>, <span class="string">'MATLAB:nearlySingularMatrix'</span>)
<span class="keyword">for</span> dimi = 1:length(dims)
  D = dims(dimi);
  seeds = 1:5;
  NmleFail(dimi) = 0; NmapFail(dimi) = 0;
  Sigma = zeros(D,D,K);

<span class="keyword">for</span> seedi=1:length(seeds)
</pre><pre class="codeinput">  setSeed(seeds(seedi));

<span class="comment">%RandStream.setDefaultStream(RandStream('mt19937ar','seed',0));</span>
mu = [-1 1 zeros(1,D-2); 1 -1 zeros(1,D-2); 3 -1 zeros(1,D-2)]';
Sigma(:,:,1) = [1 -.7 zeros(1,D-2); -.7 1 zeros(1,D-2);<span class="keyword">...</span>
    zeros(D-2,2) eye(D-2)];
Sigma(:,:,2) = [1 .7 zeros(1,D-2); .7 1 zeros(1,D-2);<span class="keyword">...</span>
    zeros(D-2,2) eye(D-2)];
Sigma(:,:,3) = [1 .9 zeros(1,D-2); .9 1 zeros(1,D-2);<span class="keyword">...</span>
    zeros(D-2,2) eye(D-2)];
X = NaN(N, D, K);
<span class="keyword">for</span> c=1:K
    R = chol(Sigma(:,:,c));
    X(:,:,c) = repmat(mu(:,c)', N, 1) + randn(N, D) * R;
<span class="keyword">end</span>
X = [X(:,:,1); X(:,:,2)];
mu0 = rand(D,K);
mixweight = normalize(ones(K,1));
</pre><h2>Fit<a name="4"></a></h2><pre class="codeinput"><span class="keyword">try</span>
  [modelGMM, loglikHistGMM] = mixGaussFitEm(X, K,<span class="keyword">...</span>
    <span class="string">'mu'</span>, mu0, <span class="string">'Sigma'</span>, Sigma, <span class="string">'mixweight'</span>, mixweight);
<span class="keyword">catch</span>
  fprintf(<span class="string">'MLE failed\n'</span>); NmleFail(dimi) = NmleFail(dimi) + 1;
<span class="keyword">end</span>

<span class="keyword">try</span>
  [modelGMMMAP, loglikHistGMMMAP] = mixGaussFitEm(X, K, <span class="keyword">...</span>
    <span class="string">'mu'</span>, mu0, <span class="string">'Sigma'</span>, Sigma, <span class="string">'mixweight'</span>, mixweight,  <span class="string">'doMAP'</span>, 1, <span class="string">'verbose'</span>, false);
<span class="keyword">catch</span>
  fprintf(<span class="string">'MAP failed\n'</span>); NmapFail(dimi) = NmapFail(dimi) + 1;
<span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">end</span>

ntrials = length(seeds);
fprintf(<span class="string">'Out of %d trials (with N=%d, D=%d), MLE failed %d times, MAP failed %d times\n'</span>, <span class="keyword">...</span>
  ntrials, N, D, NmleFail(dimi), NmapFail(dimi))


<span class="keyword">end</span>
</pre><h2>Plot<a name="6"></a></h2><pre class="codeinput">figure; hold <span class="string">on</span>
plot(dims, NmleFail/ntrials, <span class="string">'r-o'</span>, <span class="string">'linewidth'</span>, 2);
plot(dims, NmapFail/ntrials, <span class="string">'k:s'</span>, <span class="string">'linewidth'</span>, 2);
legend(<span class="string">'MLE'</span>, <span class="string">'MAP'</span>, <span class="string">'location'</span>, <span class="string">'east'</span>)
title(<span class="string">'fraction of times EM for GMM fails vs dimensionality'</span>)
axis_pct
printPmtkFigure(<span class="string">'mixGaussMLvsMAP'</span>)

warning(<span class="string">'on'</span>, <span class="string">'MATLAB:nearlySingularMatrix'</span>)
</pre><p class="footer"><br>
      Published with MATLAB&reg; 7.10<br></p></div><!--
##### SOURCE BEGIN #####
%% Demonstrate failure of MLE for GMMs in high-D case, whereas MAP works
%PMKTauthor Hannes Bretschneider
%PMTKslow

%% Create data

N = 100;
K = 3;
dims = 10:10:100;
warning('off', 'MATLAB:nearlySingularMatrix')
for dimi = 1:length(dims)
  D = dims(dimi);
  seeds = 1:5;
  NmleFail(dimi) = 0; NmapFail(dimi) = 0;
  Sigma = zeros(D,D,K); 

for seedi=1:length(seeds)
  setSeed(seeds(seedi));

%RandStream.setDefaultStream(RandStream('mt19937ar','seed',0));
mu = [-1 1 zeros(1,D-2); 1 -1 zeros(1,D-2); 3 -1 zeros(1,D-2)]';
Sigma(:,:,1) = [1 -.7 zeros(1,D-2); -.7 1 zeros(1,D-2);...
    zeros(D-2,2) eye(D-2)];
Sigma(:,:,2) = [1 .7 zeros(1,D-2); .7 1 zeros(1,D-2);...
    zeros(D-2,2) eye(D-2)];
Sigma(:,:,3) = [1 .9 zeros(1,D-2); .9 1 zeros(1,D-2);...
    zeros(D-2,2) eye(D-2)];
X = NaN(N, D, K);
for c=1:K
    R = chol(Sigma(:,:,c));
    X(:,:,c) = repmat(mu(:,c)', N, 1) + randn(N, D) * R;
end
X = [X(:,:,1); X(:,:,2)];
mu0 = rand(D,K);
mixweight = normalize(ones(K,1));


%% Fit 

try
  [modelGMM, loglikHistGMM] = mixGaussFitEm(X, K,...
    'mu', mu0, 'Sigma', Sigma, 'mixweight', mixweight);
catch
  fprintf('MLE failed\n'); NmleFail(dimi) = NmleFail(dimi) + 1;
end

try
  [modelGMMMAP, loglikHistGMMMAP] = mixGaussFitEm(X, K, ...
    'mu', mu0, 'Sigma', Sigma, 'mixweight', mixweight,  'doMAP', 1, 'verbose', false);
catch
  fprintf('MAP failed\n'); NmapFail(dimi) = NmapFail(dimi) + 1;
end


end

ntrials = length(seeds);
fprintf('Out of %d trials (with N=%d, D=%d), MLE failed %d times, MAP failed %d times\n', ...
  ntrials, N, D, NmleFail(dimi), NmapFail(dimi))


end

%% Plot
figure; hold on
plot(dims, NmleFail/ntrials, 'r-o', 'linewidth', 2);
plot(dims, NmapFail/ntrials, 'k:s', 'linewidth', 2);
legend('MLE', 'MAP', 'location', 'east')
title('fraction of times EM for GMM fails vs dimensionality')
axis_pct
printPmtkFigure('mixGaussMLvsMAP')

warning('on', 'MATLAB:nearlySingularMatrix')

##### SOURCE END #####
--></body></html>