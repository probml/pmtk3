
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      --><title>mixStudentBankruptcyDemoHannes</title><meta name="generator" content="MATLAB 7.10"><meta name="date" content="2010-03-23"><meta name="m-file" content="mixStudentBankruptcyDemoHannes"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">Fit a mixture of Gaussians and mixture of Students to some data</a></li><li><a href="#3">Load data</a></li><li><a href="#4">Fit Student</a></li><li><a href="#5">Fit Gaussian</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> [modelStud modelGauss]=mixStudentBankruptcyDemoHannes()
</pre><h2>Fit a mixture of Gaussians and mixture of Students to some data<a name="2"></a></h2><p>and use the resulting models to classify This example is based on fig 3.3 of Kenneth Lo's PhD thesis, "Statistical methods for high throughput genomics", UBC 2009</p><pre class="codeinput"><span class="comment">%PMTKauthor Hannes Bretschneider</span>
</pre><h2>Load data<a name="3"></a></h2><pre class="codeinput">bank = importdata(<span class="string">'bankruptcy.txt'</span>);
Y = bank.data(:,1); <span class="comment">% 0,1</span>
X = bank.data(:,2:3);

X = standardizeCols(X);
clear <span class="string">bank</span>;
setSeed(2);
</pre><h2>Fit Student<a name="4"></a></h2><pre class="codeinput">[N D] = size(X);
K = 2;
[modelStud, loglikHist] = mixStudentFitEm(X, K);
modelStud.dof
[z, post] = mixStudentInfer(modelStud, X);

resultplotfn(X, Y, modelStud.mu, modelStud.Sigma, post', loglikHist(end));
modelStud.post = post';
fprintf(<span class="string">'Number of errors (Student):\t %.0f\n'</span>, errors(Y, modelStud));
printPmtkFigure(<span class="string">'mixStudentDemoStudentplot'</span>)
</pre><pre class="codeoutput">ans =
    2.3393  999.9999
Number of errors (Student):	 10
</pre><img vspace="5" hspace="5" src="mixStudentBankruptcyDemoHannes_01.png" alt=""> <h2>Fit Gaussian<a name="5"></a></h2><pre class="codeinput">[N D] = size(X);
K = 2;
[modelGauss, loglikHist] = mixGaussFitEm(X, K);
[z, post] = mixGaussInfer(modelGauss, X);
modelGauss.post = post';
   resultplotfn(X, Y, modelGauss.mu, modelGauss.Sigma, modelGauss.post, loglikHist(end));
fprintf(<span class="string">'Number of errors (Gaussian): %.0f\n'</span>, errors(Y, modelGauss));
printPmtkFigure(<span class="string">'mixStudentDemoGaussplot'</span>)
</pre><pre class="codeoutput">Number of errors (Gaussian): 21
</pre><img vspace="5" hspace="5" src="mixStudentBankruptcyDemoHannes_02.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>

<span class="comment">%%%%%%</span>



<span class="keyword">function</span> resultplotfn(X, Y, mu, Sigma, post, loglik)
    n = size(X, 1);
    Yhat = (post(1,:)&gt;=post(2,:))';
    marker(logical(Y)) = <span class="string">'^'</span>;
    marker(~logical(Y)) = <span class="string">'o'</span>;
    linestyles = {<span class="string">'-'</span>, <span class="string">':'</span>};
    err = sum(Y~=Yhat); <span class="comment">% flip labels around if encoding is reversed in Yhat</span>
    <span class="keyword">if</span> err &gt; n/2
        Yhat = ~Yhat;
    <span class="keyword">end</span>
    color(Y==Yhat) = <span class="string">'b'</span>;
    color(Y~=Yhat) = <span class="string">'r'</span>;
    figure; hold <span class="string">on</span>;
    <span class="keyword">for</span> i=1:n
        plot(X(i, 1), X(i, 2), marker(i), <span class="string">'MarkerSize'</span>, 6, <span class="string">'MarkerEdgeColor'</span>, color(i));
    <span class="keyword">end</span>
    K  = size(mu,2);
    <span class="keyword">for</span> k=1:K
        h=gaussPlot2d(mu(:,k), Sigma(:,:,k), <span class="string">'color'</span>, <span class="string">'k'</span>);
        set(h, <span class="string">'linestyle'</span>, linestyles{k});
        plot(mu(1,k), mu(2,k),<span class="string">'o'</span>,<span class="string">'linewidth'</span>,2, <span class="string">'color'</span>, <span class="string">'k'</span>);
    <span class="keyword">end</span>
    axis <span class="string">square</span>
    box <span class="string">on</span>
    <span class="comment">%set(gca, 'YTick', -2:2);</span>
    xlabel(<span class="string">'RE ratio'</span>)
    ylabel(<span class="string">'EBIT ratio'</span>)
<span class="keyword">end</span>

<span class="keyword">function</span> err = errors(Y, model)
    N = length(Y);
    post = model.post;
    Yhat = (post(1,:)&gt;=post(2,:))';
    err = sum(Y ~= Yhat);
    err = min(N-err,err);
<span class="keyword">end</span>
</pre><pre class="codeoutput">ans = 
           mu: [2x2 double]
        Sigma: [2x2x2 double]
    mixweight: [0.3500 0.6500]
            K: 2
          dof: [2.3393 999.9999]
         post: [2x66 double]
</pre><p class="footer"><br>
      Published with MATLAB&reg; 7.10<br></p></div><!--
##### SOURCE BEGIN #####
function [modelStud modelGauss]=mixStudentBankruptcyDemoHannes()
%% Fit a mixture of Gaussians and mixture of Students to some data
% and use the resulting models to classify
% This example is based on fig 3.3 of Kenneth Lo's PhD thesis,
% "Statistical methods for high throughput genomics", UBC 2009
%PMTKauthor Hannes Bretschneider

%% Load data
bank = importdata('bankruptcy.txt');
Y = bank.data(:,1); % 0,1
X = bank.data(:,2:3);

X = standardizeCols(X);
clear bank;
setSeed(2);

%% Fit Student
[N D] = size(X);
K = 2; 
[modelStud, loglikHist] = mixStudentFitEm(X, K);
modelStud.dof
[z, post] = mixStudentInfer(modelStud, X);

resultplotfn(X, Y, modelStud.mu, modelStud.Sigma, post', loglikHist(end));
modelStud.post = post';
fprintf('Number of errors (Student):\t %.0f\n', errors(Y, modelStud));
printPmtkFigure('mixStudentDemoStudentplot')

%% Fit Gaussian
[N D] = size(X);
K = 2;
[modelGauss, loglikHist] = mixGaussFitEm(X, K);
[z, post] = mixGaussInfer(modelGauss, X);
modelGauss.post = post';
   resultplotfn(X, Y, modelGauss.mu, modelGauss.Sigma, modelGauss.post, loglikHist(end));
fprintf('Number of errors (Gaussian): %.0f\n', errors(Y, modelGauss));
printPmtkFigure('mixStudentDemoGaussplot')

end

%%%%%%



function resultplotfn(X, Y, mu, Sigma, post, loglik)    
    n = size(X, 1); 
    Yhat = (post(1,:)>=post(2,:))';
    marker(logical(Y)) = '^';
    marker(~logical(Y)) = 'o';
    linestyles = {'-', ':'};
    err = sum(Y~=Yhat); % flip labels around if encoding is reversed in Yhat
    if err > n/2
        Yhat = ~Yhat;
    end
    color(Y==Yhat) = 'b';
    color(Y~=Yhat) = 'r';
    figure; hold on; 
    for i=1:n
        plot(X(i, 1), X(i, 2), marker(i), 'MarkerSize', 6, 'MarkerEdgeColor', color(i));
    end
    K  = size(mu,2);
    for k=1:K
        h=gaussPlot2d(mu(:,k), Sigma(:,:,k), 'color', 'k');
        set(h, 'linestyle', linestyles{k});
        plot(mu(1,k), mu(2,k),'o','linewidth',2, 'color', 'k');
    end
    axis square
    box on
    %set(gca, 'YTick', -2:2);
    xlabel('RE ratio')
    ylabel('EBIT ratio')
end

function err = errors(Y, model)
    N = length(Y);
    post = model.post;
    Yhat = (post(1,:)>=post(2,:))';
    err = sum(Y ~= Yhat);
    err = min(N-err,err);
end
##### SOURCE END #####
--></body></html>